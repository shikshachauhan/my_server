<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>recordings_controller.rb.save - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-begin">begin</a>
    <li><a href="#label-end">end</a>
    <li><a href="#label-begin">begin</a>
    <li><a href="#label-end">end</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../AS_Database_sql.html">AS_Database.sql</a>
  
    <li><a href="../../Apis_txt.html">Apis</a>
  
    <li><a href="../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../Issues.html">Issues</a>
  
    <li><a href="../../README_rdoc.html">README</a>
  
    <li><a href="../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../Recordings/s1_mp3.html">s1.mp3</a>
  
    <li><a href="../../Recordings/s2_mp3.html">s2.mp3</a>
  
    <li><a href="../../Recordings/s3_mp3.html">s3.mp3</a>
  
    <li><a href="../../Recordings/s5_mp3.html">s5.mp3</a>
  
    <li><a href="../../Recordings/standard_mp3.html">standard.mp3</a>
  
    <li><a href="../../SAve.html">SAve</a>
  
    <li><a href="../../add_changes_sh.html">add_changes.sh</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap-theme_css.html">bootstrap-theme.css</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap-theme_css_map.html">bootstrap-theme.css.map</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap-theme_min_css.html">bootstrap-theme.min.css</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap_css.html">bootstrap.css</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap_css_map.html">bootstrap.css.map</a>
  
    <li><a href="../../app/assets/bootstrap/css/bootstrap_min_css.html">bootstrap.min.css</a>
  
    <li><a href="../../app/assets/bootstrap/fonts/glyphicons-halflings-regular_svg.html">glyphicons-halflings-regular.svg</a>
  
    <li><a href="../../app/assets/bootstrap/js/bootstrap_js.html">bootstrap.js</a>
  
    <li><a href="../../app/assets/bootstrap/js/bootstrap_min_js.html">bootstrap.min.js</a>
  
    <li><a href="../../app/assets/bootstrap/js/npm_js.html">npm.js</a>
  
    <li><a href="../../app/assets/font-awesome/less/animated_less.html">animated.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/bordered-pulled_less.html">bordered-pulled.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/core_less.html">core.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/fixed-width_less.html">fixed-width.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/font-awesome_less.html">font-awesome.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/icons_less.html">icons.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/larger_less.html">larger.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/list_less.html">list.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/mixins_less.html">mixins.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/path_less.html">path.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/rotated-flipped_less.html">rotated-flipped.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/stacked_less.html">stacked.less</a>
  
    <li><a href="../../app/assets/font-awesome/less/variables_less.html">variables.less</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_animated_scss.html">_animated.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_bordered-pulled_scss.html">_bordered-pulled.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_core_scss.html">_core.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_fixed-width_scss.html">_fixed-width.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_icons_scss.html">_icons.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_larger_scss.html">_larger.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_list_scss.html">_list.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_mixins_scss.html">_mixins.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_path_scss.html">_path.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_rotated-flipped_scss.html">_rotated-flipped.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_stacked_scss.html">_stacked.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/_variables_scss.html">_variables.scss</a>
  
    <li><a href="../../app/assets/font-awesome/scss/font-awesome_scss.html">font-awesome.scss</a>
  
    <li><a href="../../app/assets/fonts/fontawesome-webfont_svg.html">fontawesome-webfont.svg</a>
  
    <li><a href="../../app/assets/fonts/glyphicons-halflings-regular_svg.html">glyphicons-halflings-regular.svg</a>
  
    <li><a href="../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../app/assets/javascripts/bootstrap_js.html">bootstrap.js</a>
  
    <li><a href="../../app/assets/javascripts/bootstrap_min_js.html">bootstrap.min.js</a>
  
    <li><a href="../../app/assets/javascripts/contacts_coffee.html">contacts.coffee</a>
  
    <li><a href="../../app/assets/javascripts/jquery-1_11_1_js.html">jquery-1.11.1.js</a>
  
    <li><a href="../../app/assets/javascripts/jquery-1_11_1_min_js.html">jquery-1.11.1.min.js</a>
  
    <li><a href="../../app/assets/javascripts/jquery_backstretch_js.html">jquery.backstretch.js</a>
  
    <li><a href="../../app/assets/javascripts/jquery_backstretch_min_js.html">jquery.backstretch.min.js</a>
  
    <li><a href="../../app/assets/javascripts/jquery_js.html">jquery.js</a>
  
    <li><a href="../../app/assets/javascripts/location_coffee.html">location.coffee</a>
  
    <li><a href="../../app/assets/javascripts/ngo_users_js.html">ngo_users.js</a>
  
    <li><a href="../../app/assets/javascripts/placeholder_js.html">placeholder.js</a>
  
    <li><a href="../../app/assets/javascripts/registeradmin_js.html">registeradmin.js</a>
  
    <li><a href="../../app/assets/javascripts/scripts_js.html">scripts.js</a>
  
    <li><a href="../../app/assets/javascripts/sessions_js.html">sessions.js</a>
  
    <li><a href="../../app/assets/javascripts/survey_js.html">survey.js</a>
  
    <li><a href="../../app/assets/javascripts/users_js.html">users.js</a>
  
    <li><a href="../../app/assets/javascripts/welcome_js.html">welcome.js</a>
  
    <li><a href="../../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../../app/assets/stylesheets/application_css_sass.html">application.css.sass</a>
  
    <li><a href="../../app/assets/stylesheets/bootstrap_css.html">bootstrap.css</a>
  
    <li><a href="../../app/assets/stylesheets/bootstrap_min_css.html">bootstrap.min.css</a>
  
    <li><a href="../../app/assets/stylesheets/business-casual_css.html">business-casual.css</a>
  
    <li><a href="../../app/assets/stylesheets/contacts_scss.html">contacts.scss</a>
  
    <li><a href="../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../app/assets/stylesheets/font-awesome_css.html">font-awesome.css</a>
  
    <li><a href="../../app/assets/stylesheets/font-awesome_min_css.html">font-awesome.min.css</a>
  
    <li><a href="../../app/assets/stylesheets/form-elements_css.html">form-elements.css</a>
  
    <li><a href="../../app/assets/stylesheets/location_scss.html">location.scss</a>
  
    <li><a href="../../app/assets/stylesheets/ngo_users_css.html">ngo_users.css</a>
  
    <li><a href="../../app/assets/stylesheets/registeradmin_scss.html">registeradmin.scss</a>
  
    <li><a href="../../app/assets/stylesheets/sessions_scss.html">sessions.scss</a>
  
    <li><a href="../../app/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../app/assets/stylesheets/survey_scss.html">survey.scss</a>
  
    <li><a href="../../app/assets/stylesheets/users_css.html">users.css</a>
  
    <li><a href="../../app/assets/stylesheets/users_scss.html">users.scss</a>
  
    <li><a href="../../app/assets/stylesheets/welcome_css.html">welcome.css</a>
  
    <li><a href="../../app/assets/stylesheets/welcome_scss.html">welcome.scss</a>
  
    <li><a href="../../app/controllers/recordings_controller_rb_backup.html">recordings_controller.rb.backup</a>
  
    <li><a href="../../app/controllers/recordings_controller_rb_save.html">recordings_controller.rb.save</a>
  
    <li><a href="../../app/views/demo.html">demo</a>
  
    <li><a href="../../app/views/registeradmins/new_html_erb_backup.html">new.html.erb.backup</a>
  
    <li><a href="../../app/views/sessions/create_html_erb_backup.html">create.html.erb.backup</a>
  
    <li><a href="../../app/views/sessions/new_html_erb_backup.html">new.html.erb.backup</a>
  
    <li><a href="../../app/views/welcome/homepage_html_erb_backup.html">homepage.html.erb.backup</a>
  
    <li><a href="../../config_ru.html">config.ru</a>
  
    <li><a href="../../crontab_sh.html">crontab.sh</a>
  
    <li><a href="../../export_proxy_sh.html">export_proxy.sh</a>
  
    <li><a href="../../exportdb_sh.html">exportdb.sh</a>
  
    <li><a href="../../importdb_sh.html">importdb.sh</a>
  
    <li><a href="../../lib/tasks/cron_rake.html">cron.rake</a>
  
    <li><a href="../../lib/tasks/test_rake.html">test.rake</a>
  
    <li><a href="../../log/cron_error_log_log.html">cron_error_log.log</a>
  
    <li><a href="../../log/cron_log_log.html">cron_log.log</a>
  
    <li><a href="../../log/development_log.html">development.log</a>
  
    <li><a href="../../log/rpush_log.html">rpush.log</a>
  
    <li><a href="../../mysql-5_6_deb.html">mysql-5.6.deb</a>
  
    <li><a href="../../newfile.html">newfile</a>
  
    <li><a href="../../nohup_out.html">nohup.out</a>
  
    <li><a href="../../public/404_html.html">404.html</a>
  
    <li><a href="../../public/422_html.html">422.html</a>
  
    <li><a href="../../public/500_html.html">500.html</a>
  
    <li><a href="../../public/assets/application-3d32947717b0eddc881b42a48c578e091681bbec584d357b91feb3a97175cc97_js.html">application-3d32947717b0eddc881b42a48c578e091681bbec584d357b91feb3a97175cc97.js</a>
  
    <li><a href="../../public/assets/application-ad88c785b1d1901929efb6c25439f90495088e2a6fe2ade781e7ad50318d6cfb_css.html">application-ad88c785b1d1901929efb6c25439f90495088e2a6fe2ade781e7ad50318d6cfb.css</a>
  
    <li><a href="../../public/assets/bootstrap/glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5_svg.html">glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5.svg</a>
  
    <li><a href="../../public/assets/css/bootstrap-theme_css-60f70a8c0eb101c3441486c829f9c5fe9fcf3e3efdec44371cc5612009748576_map.html">bootstrap-theme.css-60f70a8c0eb101c3441486c829f9c5fe9fcf3e3efdec44371cc5612009748576.map</a>
  
    <li><a href="../../public/assets/css/bootstrap_css-daa4aebc002864fcafd6ca2befa67d9b4ff616cf2e930027ddfa7d786a3f4346_map.html">bootstrap.css-daa4aebc002864fcafd6ca2befa67d9b4ff616cf2e930027ddfa7d786a3f4346.map</a>
  
    <li><a href="../../public/assets/fontawesome-webfont-bfdef833219a6edffd9c3cbc28db72739d22bb4d20cc2e2f8d56a7a4d408a206_svg.html">fontawesome-webfont-bfdef833219a6edffd9c3cbc28db72739d22bb4d20cc2e2f8d56a7a4d408a206.svg</a>
  
    <li><a href="../../public/assets/fonts/glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5_svg.html">glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5.svg</a>
  
    <li><a href="../../public/assets/glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5_svg.html">glyphicons-halflings-regular-42f60659d265c1a3c30f9fa42abcbb56bd4a53af4d83d316d6dd7a36903c43e5.svg</a>
  
    <li><a href="../../public/assets/less/animated-c7035423d5a1e03d36bcfd6465481e4c4d5c91f316fa878a6e5103afe1b0bbf6_less.html">animated-c7035423d5a1e03d36bcfd6465481e4c4d5c91f316fa878a6e5103afe1b0bbf6.less</a>
  
    <li><a href="../../public/assets/less/bordered-pulled-8b19915b40da6b301577639e741079f9e5791dcecd7b915fa4dd7aa59888aa6a_less.html">bordered-pulled-8b19915b40da6b301577639e741079f9e5791dcecd7b915fa4dd7aa59888aa6a.less</a>
  
    <li><a href="../../public/assets/less/core-a6b6a6d3875fe1ced7ba444b4f57dc8390fb87bea7ab2c64d4478411748f58de_less.html">core-a6b6a6d3875fe1ced7ba444b4f57dc8390fb87bea7ab2c64d4478411748f58de.less</a>
  
    <li><a href="../../public/assets/less/fixed-width-0ef853a3192742d207ea0e793dc8bcc6322dcb9e50d41f4b981c4ebac2dac7ac_less.html">fixed-width-0ef853a3192742d207ea0e793dc8bcc6322dcb9e50d41f4b981c4ebac2dac7ac.less</a>
  
    <li><a href="../../public/assets/less/font-awesome-c730b24a6e611d3f86337f59855f1a277433b85d3867de5892253adf043d0ebd_less.html">font-awesome-c730b24a6e611d3f86337f59855f1a277433b85d3867de5892253adf043d0ebd.less</a>
  
    <li><a href="../../public/assets/less/icons-2b65d649e8c974fa97e4d5534ff0f810971260e0e8e5ebdca86ab8d087abb3e7_less.html">icons-2b65d649e8c974fa97e4d5534ff0f810971260e0e8e5ebdca86ab8d087abb3e7.less</a>
  
    <li><a href="../../public/assets/less/larger-dfc79d4325804e9ade21ab65145b23b1c4193d24a893690bc47b5c0739ca3c0a_less.html">larger-dfc79d4325804e9ade21ab65145b23b1c4193d24a893690bc47b5c0739ca3c0a.less</a>
  
    <li><a href="../../public/assets/less/list-024abb930e6669f215ddee19f58077571f1cabb7aee1274bf96b226c296b73d3_less.html">list-024abb930e6669f215ddee19f58077571f1cabb7aee1274bf96b226c296b73d3.less</a>
  
    <li><a href="../../public/assets/less/mixins-1eff996b33a52f61cf0c1456d03f586b925345fd59bb20fbc1bd18e25409f8f4_less.html">mixins-1eff996b33a52f61cf0c1456d03f586b925345fd59bb20fbc1bd18e25409f8f4.less</a>
  
    <li><a href="../../public/assets/less/path-79727cb6aa668b4515e0c6187653120129783e82e3f47e9e12a8d7b9cce59241_less.html">path-79727cb6aa668b4515e0c6187653120129783e82e3f47e9e12a8d7b9cce59241.less</a>
  
    <li><a href="../../public/assets/less/rotated-flipped-d67df95488eec84d2d0caf79727825a8ff4b2df90c604151783e3ec2388dad38_less.html">rotated-flipped-d67df95488eec84d2d0caf79727825a8ff4b2df90c604151783e3ec2388dad38.less</a>
  
    <li><a href="../../public/assets/less/stacked-3f9de6c3e0f1a2bc71579a417d7c415f82f2a3d3f4792161a8588bb8bdd75450_less.html">stacked-3f9de6c3e0f1a2bc71579a417d7c415f82f2a3d3f4792161a8588bb8bdd75450.less</a>
  
    <li><a href="../../public/assets/less/variables-fa6afd0d7feb78676dc2643c5ff9cdf243a4e19c9f3e26168aa89ba9928ead85_less.html">variables-fa6afd0d7feb78676dc2643c5ff9cdf243a4e19c9f3e26168aa89ba9928ead85.less</a>
  
    <li><a href="../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../public/robots_txt.html">robots</a>
  
    <li><a href="../../rebuild_sh.html">rebuild.sh</a>
  
    <li><a href="../../sms-fu_git.html">sms-fu.git</a>
  
    <li><a href="../../speedtest-cli.html">speedtest-cli</a>
  
    <li><a href="../../tmp/rpush_pid.html">rpush.pid</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page app/controllers/recordings_controller.rb.save">

<p>class <a href="../../RecordingsController.html">RecordingsController</a>
&lt; <a href="../../ApplicationController.html">ApplicationController</a>
#1</p>

<pre>def upload #2
  gcmid = params[:gcmid]
  if !gcmid.present? or !caller_ids.present? or if reason is there
          render json: { message: &#39;GCM ID not present! Failure!&#39;}, status: 403
          message = &quot;GCM ID not present! Failure!&quot;

  end
  caller_ids = params[:caller_ids]
  if !caller_ids.present? #5 if reason is there
          render json: { message: &#39;Phone numbers not present! Failure!&#39;}, status: 403
          message = &quot;Phone numbers not present! Failure!&quot;
          push_gcm(gcmid,message)
  end
  file = params[:uploadedfile]
  if !gcmid.present? #5 if reason is there
          render json: { message: &#39;GCM ID not present! Failure!&#39;}, status: 403
          message = &quot;GCM ID not present! Failure!&quot;
          push_gcm(gcmid,message)
  end      
  #gcmid = &quot;APA91bEB6mlOrCLLjGPUPQeDfV1yKirE1hAsUKgNHFb6Qw4h21bqn3ySMohZRnxJLqC8it-T04ssUjy_V11BO18Tp77Pe4ts2Eoh-5OtvYeaCFL24hklREw&quot;
  #caller_ids = &quot;9718658816,8826533273&quot;
  #name = params[:filename]
  #name = &quot;audio.mp3&quot;
  puts gcmid
  puts &quot;1&quot;
  name = params[:uploadedfile].original_filename

  puts name  
  directory = &quot;/home/myvoice/project/my_server/Recordings/&quot;
  path = File.join(directory, name)
  File.open(path, &quot;wb&quot;) { |f| f.write(params[:uploadedfile].read) }
  puts &quot;2&quot;
  flash[:notice] = &quot;File uploaded&quot;
  #redirect_to &quot;/upload/new&quot;</pre>

<h1 id="label-begin">begin<span><a href="#label-begin">&para;</a> <a href="#top">&uarr;</a></span></h1>

<pre class="ruby"><span class="ruby-identifier">target</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;w&#39;</span>)
<span class="ruby-identifier">target</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>)
<span class="ruby-identifier">target</span>.<span class="ruby-identifier">close</span>
</pre>

<h1 id="label-end">end<span><a href="#label-end">&para;</a> <a href="#top">&uarr;</a></span></h1>

<pre>  #puts file
  puts caller_ids
  #puts filename
  puts &quot;here&quot;

  admin = Admin.where(gcmid: gcmid).first  #Find the admin who has launched the message
  if admin #8
    #Create Schedule
    response = RestClient.post(&quot;http://internal.gramvaani.org:8080/vapp/api/v1/schedule/create/?api_key=38dc9ea2dc8878b8ac674b3baef02d1973de5362&amp;username=preeti&amp;format=json&quot;, ai: 10, message_id: 8, group_id: 37, name: name, start_time: &quot;08:00:00&quot;, end_time: &quot;21:00:00&quot;, is_repeated: &quot;true&quot;, days_to_repeat: &quot;0,1,2,3,4,5,6&quot;, is_active: &quot;false&quot;,is_play_ai: &quot;true&quot;)
    #Find response by running the API
    #response = {:id=&gt; 122}
    #response = response.to_json
    puts &quot;here2&quot;
    response = JSON.parse(response.body)
    puts &quot;here3&quot;
    puts response

    if response == nil #3 if response is NULL means user is unauthorized to get the response
      render json: { message: &#39;Unauthorized!&#39; }, status: 401
      message = &quot;Unauthorized!&quot;
      push_gcm(gcmid,message)
    else  #3 else if not null (MUltiple cases)
      if response[&#39;id&#39;] #4 if id is there in the response , means created the schedule
        @rec = Recording.create(MemberId: admin.id, RecFileName: name, Status: &#39;Created&#39;, GVID: response[&#39;id&#39;])
        puts &quot;here4&quot;            
        @task = Task.create(ItemId: @rec.id, TaskName: &#39;CreateRecording&#39;, Status: &#39;Created&#39;, MemberId: admin.id,GVID: response[&#39;id&#39;], Type: &#39;Recording&#39;, Contacts: caller_ids) 
        puts &quot;here5&quot;            
        @task = Task.create(ItemId: @rec.id, TaskName: &#39;DialoutRecording&#39;, Status: &#39;Pending&#39;, MemberId: admin.id, Type: &#39;Recording&#39;,GVID: response[&#39;id&#39;], Contacts: caller_ids) 
        puts &quot;here6&quot;
        render json: { message: &#39;Recording Schedule created successfully!&#39; }, status: 200
        message = &quot;Recording Schedule created successfully&quot;
        push_gcm(gcmid,message)
        #put in delivered task queue

      else #4 if objects are not there
        if response[&#39;error&#39;] #5 if reason is there
          render json: { message: &#39;Request not accepted! Parameters incorrect! Failure!&#39;}, status: 403
          message = &quot;Request not accepted! Parameters incorrect! Failure!&quot;
          push_gcm(gcmid,message)

        else #5 if reason is not there
          if response.code.to_i == 500 and response.body == &quot;Internal Server Error&quot; #6 if server error is there
            @rec = Recording.create(MemberId: admin.id, RecId: response[&#39;id&#39;], RecFileName: name, Status: &#39;PendingCreate&#39;, GVID: response[&#39;id&#39;])
            @task = Task.create(ItemId: @rec.id, TaskName: &#39;CreateRecording&#39;, Status: &#39;PendingCreate&#39;, MemberId: admin.id, Type: &#39;Recording&#39;, Contacts: caller_ids) 
            render json: { message: &#39;Internal Server Error! Server is down!&#39;}, status: 500
            message = &quot;Internal Server Error! Server is down!&quot;
            push_gcm(gcmid,message)            
            #Put in Pending Task queue

          end #6
        end #5
      end #4
    end #3
  else #8
    render json: { message: &#39;Not an Authorized Admin!&#39; }, status: 401
    message = &quot;Not an Authorized Admin!&quot;
    push_gcm(gcmid,message)  
  end #8

    #run schedule

end #2</pre>

<p>end #1</p>

<h1 id="label-begin">begin<span><a href="#label-begin">&para;</a> <a href="#top">&uarr;</a></span></h1>

<pre class="ruby"><span class="ruby-comment"># debugger</span>
<span class="ruby-comment"># params give you all the parameters in request</span>
    <span class="ruby-comment"># &#39;data&#39; for us will come from params[:uploaded_file]</span>
<span class="ruby-identifier">data</span> = <span class="ruby-identifier">params</span>[:<span class="ruby-identifier">uploadedfile</span>]
<span class="ruby-comment">#caller_ids = params[:caller_ids]</span>
    <span class="ruby-comment">#filename = data.original_filename</span>
    <span class="ruby-identifier">filename</span> = <span class="ruby-string">&quot;standard.mp3&quot;</span>
    <span class="ruby-identifier">target</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">&#39;w&#39;</span>)
    <span class="ruby-identifier">target</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">data</span>)
    <span class="ruby-identifier">target</span>.<span class="ruby-identifier">close</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>
          <span class="ruby-comment"># uploading on gramvani</span>
      <span class="ruby-identifier">container_object</span>  = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;internal.gramvaani.org&#39;</span>, <span class="ruby-value">8080</span>).<span class="ruby-identifier">request</span>(<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;/vapp/api/v1/mnews_news/create_new_item/?ai_id=60&amp;channel_id=5&amp;title=surbhi&amp;api_key=38dc9ea2dc8878b8ac674b3baef02d1973de5362&amp;username=preeti&amp;format=json&#39;</span>))
      <span class="ruby-identifier">container_object</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">container_object</span>.<span class="ruby-identifier">body</span>)
      <span class="ruby-identifier">response_object</span> = <span class="ruby-constant">RestClient</span>.<span class="ruby-identifier">post</span>(<span class="ruby-node">&quot;http://internal.gramvaani.org:8080/vapp/api/v1/mnews_news/upload_audio/?ai_id=352&amp;news_id=#{container_object[&#39;id&#39;]}&amp;api_key=38dc9ea2dc8878b8ac674b3baef02d1973de5362&amp;username=preeti&amp;format=json&quot;</span>, <span class="ruby-identifier">audio_file</span><span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>))<span class="ruby-comment">#File.new(&#39;/Users/shikshachauhan/Downloads/standard.mp3&#39;)</span>
      <span class="ruby-identifier">response_object</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">response_object</span>)  
      <span class="ruby-identifier">puts</span> <span class="ruby-identifier">container_object</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-identifier">response_object</span>
      <span class="ruby-ivar">@Rec</span> = <span class="ruby-constant">Recording</span>.<span class="ruby-identifier">create</span>(<span class="ruby-constant">MemberId</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@admin</span>.<span class="ruby-identifier">id</span>, <span class="ruby-constant">RecFileName</span><span class="ruby-operator">:</span> <span class="ruby-identifier">filename</span>, <span class="ruby-constant">Status</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Pending&quot;</span>, <span class="ruby-constant">GVID</span><span class="ruby-operator">:</span> <span class="ruby-identifier">response_object</span>[<span class="ruby-string">&#39;id&#39;</span>])
      <span class="ruby-ivar">@Task</span> = <span class="ruby-constant">Task</span>.<span class="ruby-identifier">create</span>(<span class="ruby-constant">ItemId</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@Rec</span>.<span class="ruby-identifier">id</span>, <span class="ruby-constant">TaskName</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Publish Recording&quot;</span>, <span class="ruby-constant">Status</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Publish Pending&quot;</span>, <span class="ruby-constant">MemberId</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@Rec</span>.<span class="ruby-constant">MemberId</span>, <span class="ruby-constant">GVID</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@Rec</span>.<span class="ruby-constant">GVID</span>)
      <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;File uploaded successfully&#39;</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">200</span>

    <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;File not correct&#39;</span> }, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">403</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># write the file</span>
<span class="ruby-comment">#File.open(path, &quot;wb&quot;) { |f| f.write(params[:data].read) }</span>
</pre>

<h1 id="label-end">end<span><a href="#label-end">&para;</a> <a href="#top">&uarr;</a></span></h1>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

